<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest Fire Statistics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4ecdc4;
            --secondary: #ff6b6b;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --accent: #45aaf2;
            --success: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), 
                        url("{{ url_for('static', filename='images/forest_fire_bg.jpg') }}") no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            color: var(--light);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .header {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .page-title {
            text-align: center;
    font-size: 2.8rem;
    font-weight: 700;
    color: var(--accent); /* light blue */
    margin-bottom: 5px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);

        }
        
        .page-subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .container {
            background: rgba(26, 26, 46, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 1200px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stats-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .stats-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .info-badge {
            padding: 8px 15px;
            background: rgba(78, 205, 196, 0.2);
            border-radius: 50px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .graph-button {
            padding: 15px;
            background: linear-gradient(145deg, rgba(78, 205, 196, 0.15), rgba(69, 170, 242, 0.15));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .graph-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, rgba(78, 205, 196, 0.25), rgba(69, 170, 242, 0.25));
        }
        
        .graph-button.active {
            background: linear-gradient(145deg, var(--primary), var(--accent));
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }
        
        .graph-button i {
            font-size: 1.8rem;
        }
        
        #graph-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            min-height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        #graph-canvas {
            max-width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .input-values {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .input-values h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .values-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .value-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .value-item:last-child {
            border-bottom: none;
        }
        
        .value-name {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .value-number {
            color: var(--primary);
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .button-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-title {
                font-size: 2.2rem;
            }
            
            .stats-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .values-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="{{ url_for('home') }}" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
    </div>

    <h1 class="page-title">Forest Fire Analytics</h1>
    <p class="page-subtitle">Visualize and analyze forest fire risk factors</p>

    <div class="container">
        <div class="stats-header">
            <h2 class="stats-title">Input Features Analysis</h2>
            <div class="stats-info">
                <div class="info-badge">
                    <i class="fas fa-chart-line"></i> Interactive Charts
                </div>
                <div class="info-badge">
                    <i class="fas fa-sliders-h"></i> Real-time Data
                </div>
            </div>
        </div>
        
        <div class="button-grid">
            <button class="graph-button" onclick="showGraph('bar')">
                <i class="fas fa-chart-bar"></i>
                <span>Bar Graph</span>
            </button>
            <button class="graph-button" onclick="showGraph('line')">
                <i class="fas fa-chart-line"></i>
                <span>Line Graph</span>
            </button>
            <button class="graph-button" onclick="showGraph('pie')">
                <i class="fas fa-chart-pie"></i>
                <span>Pie Chart</span>
            </button>
            <button class="graph-button" onclick="showGraph('scatter')">
                <i class="fas fa-braille"></i>
                <span>Scatter Plot</span>
            </button>
            <button class="graph-button" onclick="showGraph('histogram')">
                <i class="fas fa-chart-column"></i>
                <span>Histograms</span>
            </button>
            <button class="graph-button" onclick="showGraph('feature')">
                <i class="fas fa-star"></i>
                <span>Feature Importance</span>
            </button>
        </div>

        <div id="graph-container">
            <canvas id="graph-canvas" width="900" height="450"></canvas>
        </div>

        <div class="input-values">
            <h3><i class="fas fa-info-circle"></i> Current Input Values</h3>
            <div class="values-grid" id="input-values-display">
                <!-- Values will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
let currentChart = null;

// Get input values from URL parameters or use defaults
const urlParams = new URLSearchParams(window.location.search);
const inputFeaturesData = {
    temperature: parseFloat(urlParams.get('temperature')) || 18.8,
    humidity: parseFloat(urlParams.get('humidity')) || 44.2,
    wind: parseFloat(urlParams.get('wind_speed')) || parseFloat(urlParams.get('wind')) || 4.0,
    rain: parseFloat(urlParams.get('rainfall')) || parseFloat(urlParams.get('rain')) || 0.02,
    ffmc: parseFloat(urlParams.get('ffmc')) || 90.0,
    dmc: parseFloat(urlParams.get('dmc')) || 30.0,
    dc: parseFloat(urlParams.get('dc')) || 300.0,
    isi: parseFloat(urlParams.get('isi')) || 6.0
};

// Display current input values
const valuesGrid = document.getElementById('input-values-display');
valuesGrid.innerHTML = `
    ${Object.entries(inputFeaturesData).map(([key, value]) => `
        <div class="value-item">
            <span class="value-name">${key.charAt(0).toUpperCase() + key.slice(1)}:</span>
            <span class="value-number">${value}${['temperature'].includes(key) ? '°C' : ['humidity'].includes(key) ? '%' : ['wind'].includes(key) ? ' km/h' : ['rain'].includes(key) ? ' mm' : ''}</span>
        </div>
    `).join('')}
`;

// Normalize values for pie chart
function normalizeForPieChart(values) {
    const sum = values.reduce((a, b) => a + b, 0);
    return values.map(value => (value / sum) * 100);
}

// Prepare chart data
const chartData = {
    labels: ['Temperature', 'Humidity', 'Wind', 'Rainfall', 'FFMC', 'DMC', 'DC', 'ISI'],
    values: [
        inputFeaturesData.temperature,
        inputFeaturesData.humidity,
        inputFeaturesData.wind,
        inputFeaturesData.rain,
        inputFeaturesData.ffmc,
        inputFeaturesData.dmc,
        inputFeaturesData.dc,
        inputFeaturesData.isi
    ],
    normalizedValues: normalizeForPieChart([
        inputFeaturesData.temperature,
        inputFeaturesData.humidity,
        inputFeaturesData.wind,
        Math.max(inputFeaturesData.rain, 0.1),
        inputFeaturesData.ffmc,
        inputFeaturesData.dmc,
        inputFeaturesData.dc,
        inputFeaturesData.isi
    ]),
    importance: [0.25, 0.20, 0.15, 0.10, 0.12, 0.08, 0.06, 0.04],
    scatterData: [
        {x: inputFeaturesData.temperature, y: inputFeaturesData.humidity},
        {x: inputFeaturesData.temperature - 2, y: inputFeaturesData.humidity + 5},
        {x: inputFeaturesData.temperature + 2, y: inputFeaturesData.humidity - 5},
        {x: inputFeaturesData.temperature - 4, y: inputFeaturesData.humidity + 8},
        {x: inputFeaturesData.temperature + 4, y: inputFeaturesData.humidity - 8}
    ]
};

function showGraph(type, button) {
    // Button highlight
    document.querySelectorAll('.graph-button').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');

    // Destroy previous chart
    if(currentChart) currentChart.destroy();

    const ctx = document.getElementById('graph-canvas').getContext('2d');

    switch(type) {
        case 'bar':
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: { 
                    labels: chartData.labels, 
                    datasets: [{ 
                        label: 'Input Values', 
                        data: chartData.values, 
                        backgroundColor: 'rgba(78,205,196,0.8)' 
                    }] 
                },
                options: { 
                    responsive:true, 
                    plugins:{ title:{ display:true, text:'Input Feature Values' } },
                    scales: {
                        x: { title: { display:true, text: 'Features' } },
                        y: { title: { display:true, text: 'Values' }, beginAtZero:true }
                    }
                }
            });
            break;

        case 'line':
            currentChart = new Chart(ctx, {
                type: 'line',
                data: { 
                    labels: chartData.labels, 
                    datasets: [{ 
                        label:'Input Values', 
                        data: chartData.values, 
                        borderColor:'rgba(255,99,132,1)', 
                        backgroundColor:'rgba(255,99,132,0.2)', 
                        tension:0.4 
                    }] 
                },
                options: { 
                    responsive:true, 
                    plugins:{ title:{ display:true, text:'Line Graph of Features' } },
                    scales: {
                        x: { title: { display:true, text: 'Features' } },
                        y: { title: { display:true, text: 'Values' }, beginAtZero:true }
                    }
                }
            });
            break;

        case 'pie':
            currentChart = new Chart(ctx, {
                type: 'pie',
                data: { 
                    labels: chartData.labels, 
                    datasets: [{ 
                        data: chartData.normalizedValues, 
                        backgroundColor:[
                            '#FF6384','#36A2EB','#FFCE56','#4BC0C0',
                            '#9966FF','#FF9F40','#20B2AA','#FF69B4'
                        ] 
                    }] 
                },
                options: { 
                    responsive:true, 
                    plugins:{ title:{ display:true, text:'Normalized Feature Distribution' } } 
                }
            });
            break;

        case 'scatter':
            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: { 
                    datasets:[{ 
                        label:'Temp vs Humidity', 
                        data: chartData.scatterData, 
                        backgroundColor:'rgba(255,107,107,0.8)', 
                        pointRadius:8 
                    }] 
                },
                options: { 
                    responsive:true, 
                    plugins:{ title:{ display:true, text:'Temperature vs Humidity Correlation' } },
                    scales: {
                        x: { title: { display:true, text: 'Temperature (°C)' } },
                        y: { title: { display:true, text: 'Humidity (%)' }, beginAtZero:true }
                    }
                }
            });
            break;

        case 'feature':
            currentChart = new Chart(ctx, {
                type:'bar',
                data:{ 
                    labels: chartData.labels, 
                    datasets:[{ 
                        label:'Feature Importance', 
                        data:chartData.importance, 
                        backgroundColor:'rgba(69,170,242,0.8)' 
                    }] 
                },
                options:{ 
                    responsive:true, 
                    plugins:{ title:{ display:true, text:'Feature Importance in Fire Prediction' } },
                    scales: {
                        x: { title: { display:true, text: 'Features' } },
                        y: { title: { display:true, text: 'Importance Score' }, beginAtZero:true }
                    }
                }
            });
            break;

        case 'histogram':
            // (keep your improved histogram with axis labels)
            const dataValues = chartData.values;
            const numBins = 5;
            const minVal = Math.min(...dataValues);
            const maxVal = Math.max(...dataValues);
            const binWidth = (maxVal - minVal) / numBins;

            const binsArr = new Array(numBins).fill(0);
            dataValues.forEach(val => {
                let binIndex = Math.floor((val - minVal) / binWidth);
                if (binIndex === numBins) binIndex--; 
                binsArr[binIndex]++;
            });

            const binLabels = [];
            for (let i = 0; i < numBins; i++) {
                const start = (minVal + i * binWidth).toFixed(1);
                const end = (minVal + (i + 1) * binWidth).toFixed(1);
                binLabels.push(`${start} - ${end}`);
            }

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Frequency',
                        data: binsArr,
                        backgroundColor: 'rgba(255,206,86,0.8)',
                        borderColor: 'black',
                        borderWidth: 1,
                        barPercentage: 1.0,
                        categoryPercentage: 1.0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: 'Histogram of Feature Values' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Value Range' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Number of Features' } }
                    }
                }
            });
            break;
    }
}

// Attach showGraph to buttons
document.querySelectorAll('.graph-button').forEach(btn => {
    const type = btn.getAttribute('onclick').match(/'(\w+)'/)[1];
    btn.setAttribute('onclick', `showGraph('${type}', this)`);
});

// Show bar graph by default
document.querySelectorAll('.graph-button')[0].classList.add('active');
showGraph('bar', document.querySelectorAll('.graph-button')[0]);
</script>

</body>

</html>
